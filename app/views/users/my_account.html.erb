<div id="blue">
  <div class="container">
    <div class="row centered">
      <div class="col-lg-8 col-lg-offset-2">
        <h4><b>My account</b></h4>
        <p>account info</p>

      <center>
        <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#createSlideShoeModal">Create new Slideshow</button>
      </center>
      </div>
    </div><!-- row -->
  </div><!-- container -->
</div><!-- blue wrap -->

<div class="container">
  <div class="row centered">
    <div class="col-lg-8">
      <h1>My Slideshows</h1>
      <div class="current_slideshows slideshow_list_sect_container">
        <%= render :partial => '/slideshows/slideshow_list_sect', :locals => { :slideshows => current_user.slideshows.paginate(:page => 1), :context_page => 'account', :pag_url => '/slideshows/reload_pag_user' } %>
      </div>
    </div>
  </div><!-- row -->
</div><!-- container -->


<div class="cushion"></div>


<!-- Create Modal -->
<div id="createSlideShoeModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">New Slideshow</h4>
      </div>
      <div class="modal-body">

        <%= form_tag(create_show_slideshows_path, method: "POST", class: "create-new-slideshow-form") do %>
          <div class="form-group">
            <label for="name">Slideshow Name</label>
            <input type="text" name="name" class='form-control'>
          </div>
          <div id="slide_to_add" class='slide_to_add form-group'></div>
        <% end %>

        <div class="form-group">
          <input type="text" name="search_slides" placeholder='Search for slides' id='slide_search_input' class='form-control'>
        </div>
        <div id="slide_results_panel" class='slide_results_panel'></div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default create-slideshow-button" data-dismiss="modal">Create</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>

<!-- Edit Modal -->
<div id="editSlideShowModal" class="modal fade" role="dialog"></div>

<script>
  $('body').on('click', '.create-slideshow-button', function(event) {
    event.preventDefault();
    $('.create-new-slideshow-form').trigger('submit');
  });

  $('body').on('keyup', '#slide_search_input', function(event) {
    event.preventDefault();
    var url = '/slides/search_reload_pag_row'
    $.ajax({
      url: url,
      data: {page: 1, search: $(this).val()},
    })
    .done(function(data) {
      $('#slide_results_panel').html(data);
    })
  });

  $('body').on('click', '.add_this_slide', function(event) {
    event.preventDefault();
    var html_to_add = $(this).parent().parent().html();
    var id = $(this).attr('data-id');
    $(this).parent().parent().hide(500, function() {});
    $('#slide_to_add').append(html_to_add);
    $('#slide_to_add').append("<input type='hidden' name='slides_to_add["+id+"]' value='"+id+"'>");
  });

  $('body').on('submit', '.create-new-slideshow-form', function(event) {
    event.preventDefault();
    $('.current_slideshows').css('opacity', '.5');
    $.ajax({
      url: '/slideshows/create_show',
      type: 'POST',
      data: $(this).serialize(),
    })
    .done(function(data) {
      $('.create-new-slideshow-form').trigger('reset');
      $('.current_slideshows').html(data);
      $('button.close').trigger('click');
      $('.current_slideshows').css('opacity', '1');
    })

  });

  // edit and update slideshow
  $('body').on('click', '.edit-this-show', function(event) {
    $('#editSlideShowModal').html("");
    $.ajax({
      url: '/users/edit_slideshow_modal',
      data: {id: $(this).attr('data-id')},
    })
    .done(function(data) {
      $('#editSlideShowModal').html(data);
    })
  });


    $('body').on('submit', '.edit-slideshow-form', function(event) {
    event.preventDefault();
    var action = $(this).attr('action');
    $('.current_slideshows').css('opacity', '.5');
    $.ajax({
      url: action,
      type: 'PUT',
      data: $(this).serialize(),
    })
    .done(function(data) {
      $('.current_slideshows').html(data);
      $('button.close').trigger('click');
      $('.current_slideshows').css('opacity', '1');
      $('#editSlideShowModal').html("");
    })
  });

  $('body').on('click', '.pagination_link_container a', function(event) {
    event.preventDefault();
    var page = $(this).attr('href').split('=')[1];
    var url = '/slideshows/reload_pag_user'

    $.ajax({
      url: url,
      data: {page: page},
    })
    .done(function(data) {
      $('.slideshow_list_sect_container').html(data);
    })
  });

  $('body').on('click', '.delete-this-show', function(event) {
    event.preventDefault();
    var id = $(this).attr('data-id');
    $.ajax({
      url: '/slideshows/' + id,
      type: 'DELETE',
    })
    .done(function(data) {
      var id2 = data.id
      $('.container_for_slideshow_thumb_for_' + id2).hide(500, function() {

      });
    })

  });


</script>


<style>
  .slide_container {
    width: 150px;
    height: 170px;
  }

  .slide_container .slide-font {
    font-size: 10px;
  }

  .slide_to_add {
    position: relative;
    width: 100%;
    max-height: 200px;
    overflow: scroll;
  }
</style>
